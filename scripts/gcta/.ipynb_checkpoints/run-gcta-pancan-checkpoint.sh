#! /bin/bash
#SBATCH --mem=10G
#SBATCH -o ./out/%A.%x.%a.out # STDOUT
#SBATCH -e ./err/%A.%x.%a.err # STDERR
#SBATCH --array=1-730%50
#SBATCH --partition=carter-compute
#SBATCH --time=1-00:00:00

phenos=(SEC24B PSMA7 PSMD5 DOCK2 APOE LHFPL2 RND3 CD74 RFTN1 JAK2 ID2 CMC2 IFNGR2 KIF4A IFI44L TBXAS1 COQ2 MT1F CSF1R HSPB11 PPIH HLA.F ADCY7 RUNX3 SLC1A3 FCER1G TEX30 FAM216A GPLD1 CD33 HLA.DMA KLRK1 KIF3A CD207 IL1B PSMF1 CREBBP SEC24C HERC5 PSMC6 AP1M1 KLRB1 APOO CTSW FNBP1 PSMD8 MTA1 CDH1 RSAD2 NUP85 IFIT1 NUTF2 DVL3 TNFRSF14 DLEU1 WSB2 IFNGR1 HLA.C IFN.gamma.Response SMURF2 CCL19 MICB VEGFB OAS2 ITGA6 TRAF6 DCLRE1B DYNLL1 ZWILCH TRAT1 SEC13 EMP2 TPI1 LCP2 VEGFA IDO1 DYNC1LI2 CD8A ALOX5AP SMO JAK1 FPR3 CLTA JUP ADGRE5 COL1A2 PSMA5 TAPBP CD163 TGFBR2 CD86 DCTN5 SMS HLA.DRB1 IFI16 AP1G1 SEC24A MMP14 EIF2AK1 MFSD11 PAICS SMAD3 RNF138 PITPNC1 TCF7L2 DBNDD1 PSME1 GIMAP4 CYBA IL12A MRPL12 IGF2R EP300 CD79A TMEM130 TAPBPL OSBPL1A ID3 MARCH1 AP1M2 TPM1 PSMD12 FARSA KIF22 NCF1 LY86 ERAP1 THBS1 CBX1 FCGR3A MMP17 NLN VDAC1 MYBL2 C19orf48 PSMD11 MS4A4A NUP35 IL2RA HAUS1 SYK PSMB8 CAPZA2 RAB32 SMAD2 SAMSN1 RAB6A CENPJ PLEK HLA.DQA2 UAP1 TAP1 RHOB NUP107 HLA.E CDK2 BCAP31 POLE2 IKZF1 SNRPC CORO1C SAMHD1 DCK IGFBP2 SRM SMAD7 NOTCH2 PAK2 DDX60 SNX17 HLA.DRA SELPLG PSME3 EZR SPRYD7 IGFBP5 RHOG LYAR BTK MARVELD2 TNC IDE VAMP3 KIF15 GSTCD IFIT3 ITGB2 FCGR1B SH2B3 MX1 LRMP MARCKSL1 HLA.H FLNC CD8B SKIL CXCL9 KIF26A MAPRE1 PAK1 IFIH1 CXCR4 RASSF2 MNDA LCP1 KLC1 FCGR2A FCGR2B RNASE6 CD209 WAS THBS2 C3AR1 CAPZB MICA CLTC MTHFD1 CX3CL1 ITGA5 CD59 PSMB4 SEC31A IFI27 NID1 EVI2B TAB1 GPNMB CCL13 IGFBP3 HLA.A CALR KIF3B RAB8B F3 SAMD9 PSMC2 VTCN1 CENPN TGFB2 PSMD1 HAS2 BRIP1 SDC1 PSMB2 KIF23 GNG11 CMSS1 RAB34 SLC11A1 CTSV LYZ ITGA3 DHFR KIF2A MMP1 BSG KIFAP3 CD1C PFKP WDR54 IMP4 PRF1 ENO1 TPRKB FGL2 AMPD3 CYBB SIGLEC5 RTP4 OSBPL3 EPHB4 HLA.DQB1 CD28 KIF2C MSN PLAUR SERPINE1 BTN3A1 COL16A1 CCL21 IL7R PYCARD SNAP23 RILP SLC25A40 CD3E SKA2 LSM3 MRPS28 FAM167A SAR1A CENPO AP2B1 CD40LG DYNC1I2 ALKBH7 CD244 MNAT1 BRCA2 PSMB6 CTSD DCTN6 AP1S1 MAP2K1 GLRX3 FCGR1A EVI2A AP3B1 LRRC17 ZYX TNFSF4 PSMC3 LYN ACTR10 PSMA4 EDNRB FCGR3B EPHB3 YTHDF1 PSMD13 FGR ICAM1 UMPS CD44 CD3D Lymphocyte.Infiltration.Signature.Score TUBG1 PSME2 SELL COL8A1 RAB27A TGFB3 PSMB3 PSMB10 DYNC1LI1 HFE HACD2 ICOS C10orf54 TREM2 PDCD1 MYCBP NOP16 CCT5 BCCIP KIF11 FCGRT FMNL1 IFIT2 TLR2 TNFRSF1B HAVCR2 PA2G4 PSMD7 RAB4A AIMP2 NOD1 CCL5 CD36 SAR1B CD79B APC VSIG4 MAPK3 CENPE PSMA3 LRP1 KRR1 EPHB2 CD37 CLEC4A SEC22B FAM89B LSM4 ATG5 PDIA4 ARHGAP1 TNFRSF9 HN1L TNF PSMA2 CD6 NRIP3 AP3D1 CD1D CD53 TPSAB1 CD14 NCF2 IFI44 NUDT1 IGFBP4 PSMB7 GNLY HLA.DQB2 RAB10 SNRPE HNRNPR HLA.G APOC1 COTL1 FOXP3 MCTS1 MAGOHB CTSL LST1 DVL1 SPARC RELB Macrophage.Regulation PFN1 VCAN ITGB3 PSMC5 STK17A CXCL10 CENPW TGFB1 RBM14 IL21R VAMP8 CD70 HMGB1 HDC FPR1 CD68 DSP SNRPD1 DCTN3 ISG15 MRPL37 TAP2 CD276 PTPRC DCTN4 SH2D1A CD84 CHUK CELF2 TAGLN CTNNA1 PHF19 PDIA3 ITGAV TPM2 CORO1A Proliferation KIF3C TIMP1 CTLA4 HCK TNFSF13B HLA.DOB XCL2 LILRB2 SMAD4 ARHGDIA MAP3K8 MAP3K7 HERC6 GZMA PSMD14 RAB7A NOD2 RPN1 BLK AP2S1 SELP PNN NPL CENPU TLR4 TPM3 PSMC4 PSMB1 FN1 MPP1 CDH6 CTSS TGFBR1 ADORA2A ITGB5 WDHD1 PSMA1 DYNC1I1 EIF4G1 PTGER4 OAS1 ARHGAP15 SP140 IFI30 CD40 C11orf24 FARSB NUP93 TNFRSF4 DUT TBX21 HLA.DOA SNRPB PIK3CG CAPZA1 PLCG2 ARF1 RAC1 PDCD1LG2 NEO1 PGM2 MYL6 XCL1 SMC2 HLA.DPA1 SLC25A5 SPTBN2 Macrophages.M2 IPO4 FBXO41 ERLIN1 MCM3 MCM7 CTNNB1 PDAP1 T.cells.CD8 RFC3 AP2A2 PSMD3 SPAG17 ADAMTS1 HMGN2 COPS6 CD80 ICOSLG MR1 SLAMF7 CD274 KLC2 NCLN RASSF4 PLOD2 SKA1 USPL1 TNFSF9 JUNB ENTPD1 TNFRSF18 CSF3R PSMD10 EOMES KLRD1 LOXL2 VTA1 LILRB4 HSD11B1 BTLA FYB GZMH POLR3K SEMA3F HNRNPA2B1 RAB5B RHOC DYNLT1 MYO1F T.cells.follicular.helper IL10RA CPA3 RHOA MYBL1 TRA2B UQCR10 IKBKG PSMC1 HLA.DRB5 CKLF NCEH1 JCHAIN TIGIT RAB35 PLAT DAPK1 LAMB1 RACGAP1 CECR1 CCBL2 HYLS1 RUVBL1 CD52 AP1S3 ITGB8 NME1 CCR7 IL18 SNRPA1 TNFRSF1A GGH Wound.Healing LTB ACTR1B LAPTM5 DDX58 LAMA4 LGMN MS4A1 H2AFZ STRA13 COL6A3 RHOQ PNO1 LAG3 IFRD2 HCLS1 PSMD4 ACTL6A SEC23A DCTN1 NUDT15 ARRB2 AP2A1 MERTK DYNC1H1 TNFAIP3 DCTN2 NKG7 EIF4EBP1 IKBKB CD3G IFI6 LAIR1 MRTO4 MMP11 RMND5B COL6A1 FGD1 TPSB2 TNFRSF12A HSPG2 RAB33A CASP1 PSMB5 CPEB4 SLC16A1 SNRPA ACTR1A HMHA1 TUBA4A GZMB RNF41 KIF18A IL10 OASL ACE HLA.B TGF.beta.Response CD27 CEP78 CCRL2 MET TREX1 TCEB1 FLI1 WIPF1 C1orf54 PSME4 MMP19 TOMM40 STAT1 EBNA1BP2 MMP2 PSMB9 AP1S2 HLA.DMB UBE2J1 ITGA4 GNPTAB IL1A WDR77 HLA.DPB1 HLA.DQA1 CTSF CD1E CPVL EPHA2 COX17 SH3BP5L ERAP2 CTSC LCK LRRC40 ZFYVE9 PSMD6 CCL2 BTN3A2 SLC7A7 DNM2 LNPEP CHEK1 PXN PSMD2 PLK4 SEC24D AZGP1 DYNLL2 DCBLD2 CD48 MRPS16 PSMA6 CTSH COL3A1 RPP40 EFNA5 NCKAP1L B2M CANX LMNB2 NPC2 KIF4B PSMD9 CYTIP EXOSC8 WNT2B SPIB OAS3 AP1B1 APITD1 CDCA4 NCF4 AP2M1 CD247 PDLIM7 MKKS)
pheno=${phenos[$SLURM_ARRAY_TASK_ID-1]}
echo $SLURM_ARRAY_TASK_ID
echo $HOSTNAME
echo $pheno

date

path_gcta=/cellar/users/mpagadal/Programs/gcta_1.93.2beta/gcta64
path_plink2=/cellar/users/mpagadal/Programs/plink2
path_geno=/cellar/users/mpagadal/data/tcga/germline/imputation/michigan-imputation/HRC/european.final.noimmunecancers.clean
path_pheno=/cellar/users/mpagadal/projects/germline-immune3/data/gcta/phenotypes_intersect/pancanatlas
path_grm=/cellar/users/mpagadal/gcta/grms/tcga/european/full
path_results=/cellar/users/mpagadal/projects/germline-immune3/data/gcta/greml/intersect/pancanatlas/full

covar=/cellar/users/mpagadal/gcta/covs/tcga.eur.sex.covar #categorical covariates
qcovar=/cellar/users/mpagadal/gcta/covs/tcga.eur.age.qcovar #quantitative covariates


################################
# RUN GCTA ON WHOLE GENOME GRM #
################################

mkdir $path_results

$path_gcta --grm $path_grm/tcga.eur --reml --pheno $path_pheno/$pheno.phen --covar $covar --qcovar $qcovar --out $path_results/$pheno


########################################
# RUN GCTA ON ONLY HLA-KIR REGIONS GRM #
########################################

path_geno=/cellar/controlled/dbgap-genetic/phs000178_TCGA/imputation/michigan-imputation/HRC/hla-kir
path_grm=/cellar/users/mpagadal/gcta/grms/tcga/european/hla-kir
path_results=/cellar/users/mpagadal/projects/germline-immune3/data/gcta/greml/intersect/pancanatlas/hla-kir

mkdir $path_results

$path_gcta --grm $path_grm/eur.hla.kir --reml --pheno $path_pheno/$pheno.phen --covar $covar --qcovar $qcovar --out $path_results/$pheno


############################################
# RUN GCTA ON ONLY non-HLA-KIR REGIONS GRM #
# ############################################

path_geno=/cellar/controlled/dbgap-genetic/phs000178_TCGA/imputation/michigan-imputation/HRC/hla-kir
path_grm=/cellar/users/mpagadal/gcta/grms/tcga/european/hla-kir
path_results=/cellar/users/mpagadal/projects/germline-immune3/data/gcta/greml/intersect/pancanatlas/no-hla-kir

mkdir $path_results

$path_gcta --grm $path_grm/eur.no.hla.kir --reml --pheno $path_pheno/$pheno.phen --covar $covar --qcovar $qcovar --out $path_results/$pheno



date
